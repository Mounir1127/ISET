import{g as m}from"./chunk-5PZCWADI.js";import{a as p}from"./chunk-JUIKBY4O.js";import{L as n,O as l,T as a,hc as i,j as u,m as c,oa as g}from"./chunk-5SKKYWQC.js";var f=class o{constructor(e,t,r){this.http=e;this.router=t;this.platformId=r;this.currentUserSubject=new u(null);this.currentUser=this.currentUserSubject.asObservable();this.apiUrl="api/auth";this.checkAuthStatus()}get currentUserValue(){return this.currentUserSubject.value}checkAuthStatus(){if(i(this.platformId))try{let e=localStorage.getItem("currentUser"),t=sessionStorage.getItem("currentUser"),r=e||t;if(r&&r!=="undefined"&&r!=="null"){let s=JSON.parse(r);s&&(s.role||s.name)&&(this.currentUserSubject.next(s),console.log("Session restored for:",s.name,"Role:",s.role))}}catch(e){console.error("Auth persistence error:",e),localStorage.removeItem("currentUser"),sessionStorage.removeItem("currentUser"),this.currentUserSubject.next(null)}}login(e){return this.http.post("/api/login",e).pipe(n(t=>{let r=t.user;i(this.platformId)&&(e.rememberMe&&localStorage.setItem("currentUser",JSON.stringify(r)),sessionStorage.setItem("currentUser",JSON.stringify(r))),this.currentUserSubject.next(r)}))}register(e){return this.http.post("/api/register",e).pipe(n(t=>{let r=t.user;i(this.platformId)&&(localStorage.setItem("currentUser",JSON.stringify(r)),sessionStorage.setItem("currentUser",JSON.stringify(r))),this.currentUserSubject.next(r)}))}logout(){i(this.platformId)&&(localStorage.removeItem("currentUser"),sessionStorage.removeItem("currentUser")),this.currentUserSubject.next(null),i(this.platformId)&&this.router.navigate(["/login"])}getCurrentUser(){let e=this.currentUserSubject.value;if(!e&&i(this.platformId)){let t=localStorage.getItem("currentUser")||sessionStorage.getItem("currentUser");if(t&&t!=="undefined"&&t!=="null")try{e=JSON.parse(t),e&&this.currentUserSubject.next(e)}catch{return null}}return e}updateProfile(e,t){return this.http.put(`/api/user/profile/${e}`,t).pipe(n(r=>{let s=r.user;i(this.platformId)&&(localStorage.setItem("currentUser",JSON.stringify(s)),sessionStorage.setItem("currentUser",JSON.stringify(s))),this.currentUserSubject.next(s)}))}changePassword(e,t){return this.http.put(`/api/user/password/${e}`,t)}isAuthenticated(){return!!this.getCurrentUser()}getDepartments(){return this.http.get("/api/public/departments")}getClasses(){return this.http.get("/api/public/classes")}getModules(){return this.http.get("/api/public/modules")}socialLogin(e){return c({id:"3",name:"Utilisateur SSO",email:`sso@${e}.com`,matricule:"SSO001",role:"student"}).pipe(n(t=>{i(this.platformId)&&localStorage.setItem("currentUser",JSON.stringify(t)),this.currentUserSubject.next(t)}))}static{this.\u0275fac=function(t){return new(t||o)(a(p),a(m),a(g))}}static{this.\u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"})}};export{f as a};
