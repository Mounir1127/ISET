import{b as I,d as k,h as W,j as G,n as z,o as F,q as D,r as V,s as B,w as L}from"./chunk-ADCJ3DLS.js";import{a as R}from"./chunk-WHKQ75FP.js";import"./chunk-JUIKBY4O.js";import{$ as M,$b as N,Ab as u,Ia as r,Ma as P,Ra as y,Wa as m,_ as b,_b as w,a as S,b as O,bb as c,db as h,ec as T,fb as t,gb as n,hb as p,kb as x,lb as C,mb as E,sb as o,tb as _,ub as v,yb as g,zb as f}from"./chunk-5SKKYWQC.js";function j(s,a){s&1&&p(0,"i",27)}function Y(s,a){s&1&&p(0,"i",28)}function q(s,a){if(s&1&&(t(0,"option",29),o(1),n()),s&2){let e=a.$implicit;c("value",e._id),r(),_(e.name)}}function X(s,a){if(s&1&&(t(0,"option",29),o(1),n()),s&2){let e=a.$implicit;c("value",e._id),r(),_(e.name)}}function H(s,a){s&1&&(t(0,"div",30),p(1,"i",31),t(2,"p"),o(3,"Chargement des donn\xE9es..."),n()())}function J(s,a){if(s&1){let e=x();t(0,"tr")(1,"td"),o(2),n(),t(3,"td")(4,"div",36)(5,"span",37),o(6),n()()(),t(7,"td")(8,"span",38),o(9),n()(),t(10,"td")(11,"div",39)(12,"input",40),u("ngModelChange",function(d){let l=b(e).$implicit;return f(l.tempNote,d)||(l.tempNote=d),M(d)}),n()()(),t(13,"td")(14,"textarea",41),u("ngModelChange",function(d){let l=b(e).$implicit;return f(l.tempRemark,d)||(l.tempRemark=d),M(d)}),n()(),t(15,"td")(16,"span",42),o(17),n()()()}if(s&2){let e=a.$implicit,i=a.index;r(2),_(i+1),r(4),_(e.name),r(3),_(e.matricule),r(3),h("low",e.tempNote!==null&&e.tempNote<10)("high",e.tempNote!==null&&e.tempNote>=15),g("ngModel",e.tempNote),r(2),g("ngModel",e.tempRemark),r(2),h("validated",e.tempNote!==null),r(),v(" ",e.tempNote!==null?"Saisie":"En attente"," ")}}function K(s,a){s&1&&(t(0,"div",43),p(1,"i",44),t(2,"p"),o(3,"Aucun \xE9tudiant trouv\xE9 pour cette s\xE9lection."),n()())}function Q(s,a){if(s&1&&(t(0,"div",32)(1,"table",33)(2,"thead")(3,"tr")(4,"th"),o(5,"N\xB0"),n(),t(6,"th"),o(7,"\xC9tudiant"),n(),t(8,"th"),o(9,"Matricule"),n(),t(10,"th"),o(11,"Note (/20)"),n(),t(12,"th"),o(13,"Remarque"),n(),t(14,"th"),o(15,"Statut"),n()()(),t(16,"tbody"),m(17,J,18,12,"tr",34),n()(),m(18,K,4,0,"div",35),n()),s&2){let e=E();r(17),c("ngForOf",e.filteredStudents()),r(),c("ngIf",!e.loading&&e.students.length===0)}}var A=class s{constructor(a){this.staffService=a;this.modules=[];this.groups=[];this.students=[];this.selectedModule=null;this.selectedGroup="all";this.selectedEvalType="DS";this.loading=!1;this.saving=!1;this.searchTerm=""}ngOnInit(){this.loadInitialData()}loadInitialData(){this.loading=!0,this.staffService.getModules().subscribe({next:a=>{this.modules=a,this.loading=!1},error:a=>{console.error("Error modules",a),this.loading=!1}}),this.groups=[{_id:"g1",name:"DSI 3.1"},{_id:"g2",name:"DSI 3.2"},{_id:"g3",name:"RSI 2.1"}]}loadGrades(){this.selectedModule&&(this.loading=!0,this.staffService.getGrades(this.selectedModule,this.selectedGroup!=="all"?this.selectedGroup:void 0).subscribe({next:a=>{this.staffService.getStudents(this.selectedGroup!=="all"?this.selectedGroup:void 0).subscribe({next:e=>{this.students=e.map(i=>{let d=a.find(l=>l.student._id===i._id&&l.examType===this.selectedEvalType);return O(S({},i),{tempNote:d?d.value:null,tempRemark:d?d.remarks:""})}),this.loading=!1}})},error:a=>{console.error("Error grades",a),this.loading=!1}}))}filteredStudents(){let a=this.searchTerm.toLowerCase();return this.students.filter(e=>e.name.toLowerCase().includes(a)||e.matricule.includes(a))}saveAll(){if(!this.selectedModule)return;this.saving=!0;let a=this.students.filter(e=>e.tempNote!==null).map(e=>({student:e._id,module:this.selectedModule,value:e.tempNote,remarks:e.tempRemark,examType:this.selectedEvalType,semester:"1",academicYear:"2024/2025"}));this.staffService.updateGradesBulk(a).subscribe({next:()=>{this.saving=!1,alert("Notes enregistr\xE9es avec succ\xE8s !")},error:e=>{this.saving=!1,console.error("Save error",e)}})}static{this.\u0275fac=function(e){return new(e||s)(P(R))}}static{this.\u0275cmp=y({type:s,selectors:[["app-staff-notes"]],decls:50,vars:13,consts:[[1,"notes-management"],[1,"control-header","glass-card"],[1,"header-main"],[1,"title-wrap"],[1,"header-actions"],[1,"btn-primary",3,"click","disabled"],["class","fas fa-save",4,"ngIf"],["class","fas fa-spinner fa-spin",4,"ngIf"],[1,"selection-grid"],[1,"select-field"],[1,"glass-select",3,"ngModelChange","change","ngModel"],["disabled","",3,"ngValue"],[3,"value",4,"ngFor","ngForOf"],["value","all"],["value","DS"],["value","EX"],["value","TP"],["value","CC"],[1,"notes-content","glass-card"],[1,"table-actions"],[1,"count-tag"],[1,"fas","fa-users"],[1,"search-mini"],[1,"fas","fa-search"],["type","text","placeholder","Trouver un \xE9tudiant...",3,"ngModelChange","ngModel"],["class","loading-state",4,"ngIf"],["class","table-scroll",4,"ngIf"],[1,"fas","fa-save"],[1,"fas","fa-spinner","fa-spin"],[3,"value"],[1,"loading-state"],[1,"fas","fa-circle-notch","fa-spin"],[1,"table-scroll"],[1,"notes-table"],[4,"ngFor","ngForOf"],["class","empty-table",4,"ngIf"],[1,"student-info"],[1,"name"],[1,"mat-badge"],[1,"input-wrap"],["type","number","step","0.25","min","0","max","20",1,"note-input",3,"ngModelChange","ngModel"],["placeholder","RAS",1,"glass-textarea",3,"ngModelChange","ngModel"],[1,"status-tag"],[1,"empty-table"],[1,"fas","fa-user-slash"]],template:function(e,i){e&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2"),o(5,"Saisie des Notes"),n(),t(6,"p"),o(7,"G\xE9rez les \xE9valuations et saisissez les notes de vos groupes."),n()(),t(8,"div",4)(9,"button",5),C("click",function(){return i.saveAll()}),m(10,j,1,0,"i",6)(11,Y,1,0,"i",7),o(12," Enregistrer Tout "),n()()(),t(13,"div",8)(14,"div",9)(15,"label"),o(16,"Mati\xE8re / Module"),n(),t(17,"select",10),u("ngModelChange",function(l){return f(i.selectedModule,l)||(i.selectedModule=l),l}),C("change",function(){return i.loadGrades()}),t(18,"option",11),o(19,"S\xE9lectionnez un module"),n(),m(20,q,2,2,"option",12),n()(),t(21,"div",9)(22,"label"),o(23,"Groupe / Classe"),n(),t(24,"select",10),u("ngModelChange",function(l){return f(i.selectedGroup,l)||(i.selectedGroup=l),l}),C("change",function(){return i.loadGrades()}),t(25,"option",13),o(26,"Tous les groupes"),n(),m(27,X,2,2,"option",12),n()(),t(28,"div",9)(29,"label"),o(30,"Type d'\xC9valuation"),n(),t(31,"select",10),u("ngModelChange",function(l){return f(i.selectedEvalType,l)||(i.selectedEvalType=l),l}),C("change",function(){return i.loadGrades()}),t(32,"option",14),o(33,"Devoir de Contr\xF4le (DS)"),n(),t(34,"option",15),o(35,"Examen Final"),n(),t(36,"option",16),o(37,"Travaux Pratiques"),n(),t(38,"option",17),o(39,"Contr\xF4le Continu"),n()()()()(),t(40,"div",18)(41,"div",19)(42,"span",20),p(43,"i",21),o(44),n(),t(45,"div",22),p(46,"i",23),t(47,"input",24),u("ngModelChange",function(l){return f(i.searchTerm,l)||(i.searchTerm=l),l}),n()()(),m(48,H,4,0,"div",25)(49,Q,19,2,"div",26),n()()),e&2&&(r(9),c("disabled",i.loading||!i.selectedModule),r(),c("ngIf",!i.saving),r(),c("ngIf",i.saving),r(6),g("ngModel",i.selectedModule),r(),c("ngValue",null),r(2),c("ngForOf",i.modules),r(4),g("ngModel",i.selectedGroup),r(3),c("ngForOf",i.groups),r(4),g("ngModel",i.selectedEvalType),r(13),v(" ",i.students.length," \xE9tudiants"),r(3),g("ngModel",i.searchTerm),r(),c("ngIf",i.loading),r(),c("ngIf",!i.loading))},dependencies:[T,w,N,L,F,D,I,G,z,k,B,V,W],styles:[".notes-management[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;animation:_ngcontent-%COMP%_fadeIn .6s ease}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.glass-card[_ngcontent-%COMP%]{background:#fffc;backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.5);border-radius:24px;padding:2.2rem;box-shadow:0 10px 30px #00000008}.header-main[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2.5rem}.header-main[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:900;color:#0f172a}.header-main[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#64748b;font-weight:500}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#0055a4,#0077c8);color:#fff;border:none;padding:.9rem 2rem;border-radius:14px;font-weight:800;cursor:pointer;display:flex;align-items:center;gap:.8rem;box-shadow:0 10px 20px #0055a426;transition:all .3s}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 15px 30px #0055a440}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.selection-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:2rem}.selection-grid[_ngcontent-%COMP%]   .select-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:.85rem;font-weight:800;color:#0f172a;margin-bottom:.8rem;text-transform:uppercase;letter-spacing:.5px}.selection-grid[_ngcontent-%COMP%]   .select-field[_ngcontent-%COMP%]   .glass-select[_ngcontent-%COMP%]{width:100%;background:#f1f5f9;border:1px solid transparent;padding:1rem;border-radius:16px;font-family:inherit;font-weight:700;color:#0f172a;cursor:pointer}.selection-grid[_ngcontent-%COMP%]   .select-field[_ngcontent-%COMP%]   .glass-select[_ngcontent-%COMP%]:focus{background:#fff;border-color:#0055a4;outline:none;box-shadow:0 0 0 4px #0055a414}.table-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}.table-actions[_ngcontent-%COMP%]   .count-tag[_ngcontent-%COMP%]{background:#eff6ff;color:#0055a4;padding:.5rem 1.2rem;border-radius:10px;font-weight:800;font-size:.85rem;display:flex;align-items:center;gap:.6rem}.table-actions[_ngcontent-%COMP%]   .search-mini[_ngcontent-%COMP%]{position:relative}.table-actions[_ngcontent-%COMP%]   .search-mini[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:absolute;left:1rem;top:50%;transform:translateY(-50%);color:#94a3b8}.table-actions[_ngcontent-%COMP%]   .search-mini[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:#f8fafc;border:1px solid #e2e8f0;padding:.6rem 1rem .6rem 2.8rem;border-radius:12px;font-family:inherit;font-size:.9rem}.table-actions[_ngcontent-%COMP%]   .search-mini[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#0055a4;background:#fff}.notes-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.notes-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1.2rem 1.5rem;text-align:left;font-size:.8rem;font-weight:850;color:#94a3b8;border-bottom:2px solid #f1f5f9;text-transform:uppercase;letter-spacing:1px}.notes-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1.2rem 1.5rem;border-bottom:1px solid #f1f5f9;vertical-align:middle}.notes-table[_ngcontent-%COMP%]   .student-info[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:800;color:#0f172a;font-size:.95rem}.notes-table[_ngcontent-%COMP%]   .mat-badge[_ngcontent-%COMP%]{font-family:monospace;font-weight:700;color:#64748b;background:#f1f5f9;padding:.3rem .6rem;border-radius:6px;font-size:.8rem}.notes-table[_ngcontent-%COMP%]   .note-input[_ngcontent-%COMP%]{width:80px;padding:.8rem;border-radius:12px;border:2px solid #e2e8f0;background:#f8fafc;font-weight:900;text-align:center;font-size:1.1rem;color:#0f172a;transition:all .3s}.notes-table[_ngcontent-%COMP%]   .note-input[_ngcontent-%COMP%]::-webkit-inner-spin-button{opacity:1}.notes-table[_ngcontent-%COMP%]   .note-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#0055a4;background:#fff}.notes-table[_ngcontent-%COMP%]   .note-input.low[_ngcontent-%COMP%]{color:#ef4444;border-color:#fee2e2}.notes-table[_ngcontent-%COMP%]   .note-input.high[_ngcontent-%COMP%]{color:#10b981;border-color:#d1fae5}.notes-table[_ngcontent-%COMP%]   .glass-textarea[_ngcontent-%COMP%]{width:100%;min-height:40px;background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px;padding:.6rem;font-family:inherit;resize:none;font-size:.85rem}.notes-table[_ngcontent-%COMP%]   .glass-textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#0055a4}.notes-table[_ngcontent-%COMP%]   .status-tag[_ngcontent-%COMP%]{font-size:.75rem;font-weight:800;padding:.4rem .8rem;border-radius:50px;background:#f1f5f9;color:#64748b}.notes-table[_ngcontent-%COMP%]   .status-tag.validated[_ngcontent-%COMP%]{background:#dcfce7;color:#15803d}.notes-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover   td[_ngcontent-%COMP%]{background:#0055a405}.loading-state[_ngcontent-%COMP%], .empty-table[_ngcontent-%COMP%]{padding:4rem;text-align:center;color:#64748b}:is(.loading-state[_ngcontent-%COMP%], .empty-table[_ngcontent-%COMP%])   i[_ngcontent-%COMP%]{font-size:2.5rem;margin-bottom:1rem;color:#cbd5e1}"]})}};export{A as StaffNotesComponent};
