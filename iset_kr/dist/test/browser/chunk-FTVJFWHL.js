import{a as h}from"./chunk-JXVCW6UT.js";import{d as f}from"./chunk-OLM244A5.js";import{a as m}from"./chunk-RGDPBHKT.js";import{L as n,O as p,T as a,j as u,kc as s,m as c,oa as g,r as l}from"./chunk-VLARTZ6X.js";var b=class o{constructor(t,e,i){this.http=t;this.router=e;this.platformId=i;this.currentUserSubject=new u(null);this.currentUser=this.currentUserSubject.asObservable();this.apiUrl=h.apiUrl;this.checkAuthStatus()}get currentUserValue(){return this.currentUserSubject.value}checkAuthStatus(){if(s(this.platformId))try{let t=localStorage.getItem("currentUser"),e=sessionStorage.getItem("currentUser"),i=t||e;if(i&&i!=="undefined"&&i!=="null"){let r=JSON.parse(i);r&&(r.role||r.name)&&(this.currentUserSubject.next(r),console.log("Session restored for:",r.name,"Role:",r.role))}}catch(t){console.error("Auth persistence error:",t),localStorage.removeItem("currentUser"),sessionStorage.removeItem("currentUser"),this.currentUserSubject.next(null)}}login(t){return this.http.post(`${this.apiUrl}/login`,t).pipe(l(e=>e.user),n(e=>{s(this.platformId)&&(t.rememberMe&&localStorage.setItem("currentUser",JSON.stringify(e)),sessionStorage.setItem("currentUser",JSON.stringify(e))),this.currentUserSubject.next(e)}))}register(t){return this.http.post(`${this.apiUrl}/register`,t).pipe(l(e=>e.user),n(e=>{s(this.platformId)&&(localStorage.setItem("currentUser",JSON.stringify(e)),sessionStorage.setItem("currentUser",JSON.stringify(e))),this.currentUserSubject.next(e)}))}logout(){s(this.platformId)&&(localStorage.removeItem("currentUser"),sessionStorage.removeItem("currentUser")),this.currentUserSubject.next(null),s(this.platformId)&&this.router.navigate(["/login"])}getCurrentUser(){let t=this.currentUserSubject.value;if(!t&&s(this.platformId)){let e=localStorage.getItem("currentUser")||sessionStorage.getItem("currentUser");if(e&&e!=="undefined"&&e!=="null")try{t=JSON.parse(e),t&&this.currentUserSubject.next(t)}catch{return null}}return t}updateProfile(t,e){return this.http.put(`${this.apiUrl}/user/profile/${t}`,e).pipe(n(i=>{let r=i.user;s(this.platformId)&&(localStorage.setItem("currentUser",JSON.stringify(r)),sessionStorage.setItem("currentUser",JSON.stringify(r))),this.currentUserSubject.next(r)}))}changePassword(t,e){return this.http.put(`${this.apiUrl}/user/password/${t}`,e)}forgotPassword(t){return this.http.post(`${this.apiUrl}/forgot-password`,{email:t})}isAuthenticated(){return!!this.getCurrentUser()}getDepartments(){return this.http.get(`${this.apiUrl}/public/departments`)}getClasses(){return this.http.get(`${this.apiUrl}/public/classes`)}getModules(){return this.http.get(`${this.apiUrl}/public/modules`)}socialLogin(t){return c({id:"3",name:"Utilisateur SSO",email:`sso@${t}.com`,matricule:"SSO001",role:"student"}).pipe(n(e=>{s(this.platformId)&&localStorage.setItem("currentUser",JSON.stringify(e)),this.currentUserSubject.next(e)}))}static{this.\u0275fac=function(e){return new(e||o)(a(m),a(f),a(g))}}static{this.\u0275prov=p({token:o,factory:o.\u0275fac,providedIn:"root"})}};export{b as a};
