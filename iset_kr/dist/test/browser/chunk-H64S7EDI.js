import{b as F,d as L,e as D,g as N,h as U,i as B,n as j,o as z,q as G,t as R,w as q}from"./chunk-A3SAA77A.js";import{a as O}from"./chunk-UEIEFBUG.js";import"./chunk-JXVCW6UT.js";import"./chunk-RGDPBHKT.js";import{$ as m,Ab as g,Bb as f,Ga as w,Ja as d,Na as S,Sa as y,Xa as v,_ as c,a as T,ac as V,b as E,bc as I,cb as u,cc as k,eb as A,gb as e,hb as i,hc as W,ib as _,lb as M,mb as x,nb as s,sb as P,tb as o,ub as b,vb as C,zb as h}from"./chunk-VLARTZ6X.js";function J(p,a){if(p&1){let n=M();e(0,"tr")(1,"td",11)(2,"div",17),_(3,"img",18),e(4,"div")(5,"div",19),o(6),i(),e(7,"div",20),o(8),i()()()(),e(9,"td")(10,"span",21),o(11),i()(),e(12,"td")(13,"span",22),o(14),i()(),e(15,"td")(16,"span",23),o(17),i()(),e(18,"td",12)(19,"button",24),x("click",function(){let t=c(n).$implicit,l=s();return m(l.editTeacher(t))}),_(20,"i",25),i(),e(21,"button",26),x("click",function(){let t=c(n).$implicit,l=s();return m(l.deleteTeacher(t._id))}),_(22,"i",27),i()()()}if(p&2){let n=a.$implicit,r=s();d(3),u("src",r.dataService.getImageUrl(n.profileImage,n.name),w),d(3),b(n.name),d(2),b(n.email),d(3),C(" ",(n.department==null?null:n.department.name)||"Inconnu"," "),d(3),b(n.grade),d(2),u("ngClass",n.status==="active"?"bg-success-soft text-success":"bg-warning-soft text-warning"),d(),C(" ",n.status==="active"?"Actif":"En attente"," ")}}function H(p,a){p&1&&(e(0,"tr")(1,"td",28),_(2,"i",29),e(3,"p"),o(4,"Aucun enseignant trouv\xE9."),i()()())}function K(p,a){p&1&&_(0,"div",30)}function Q(p,a){if(p&1&&(e(0,"option",81),o(1),i()),p&2){let n=a.$implicit;u("value",n._id),d(),b(n.name)}}function X(p,a){p&1&&_(0,"span",82)}function Z(p,a){if(p&1){let n=M();e(0,"div",31)(1,"div",32)(2,"div",33)(3,"div",34)(4,"h5",35),o(5),i(),e(6,"button",36),x("click",function(){c(n);let t=s();return m(t.closeModal())}),i()(),e(7,"div",37)(8,"div",38)(9,"div",39)(10,"div",40),_(11,"img",41),e(12,"label",42),_(13,"i",43),i(),e(14,"input",44),x("change",function(t){c(n);let l=s();return m(l.onFileSelected(t))}),i()(),e(15,"div",45)(16,"label",46),o(17,"Statut du Compte"),i(),e(18,"select",47),f("ngModelChange",function(t){c(n);let l=s();return g(l.currentTeacher.status,t)||(l.currentTeacher.status=t),m(t)}),e(19,"option",48),o(20,"Actif"),i(),e(21,"option",49),o(22,"En attente"),i(),e(23,"option",50),o(24,"Inactif"),i()()(),e(25,"div",51)(26,"label",46),o(27,"R\xF4le"),i(),e(28,"select",52),f("ngModelChange",function(t){c(n);let l=s();return g(l.currentTeacher.role,t)||(l.currentTeacher.role=t),m(t)}),e(29,"option",53),o(30,"Enseignant"),i(),e(31,"option",54),o(32,"Chef de D\xE9pt"),i(),e(33,"option",55),o(34,"Administrateur"),i()()()(),e(35,"div",56)(36,"form",null,0)(38,"div",57)(39,"div",58)(40,"label",46),o(41,"Nom Complet"),i(),e(42,"input",59),f("ngModelChange",function(t){c(n);let l=s();return g(l.currentTeacher.name,t)||(l.currentTeacher.name=t),m(t)}),i()(),e(43,"div",58)(44,"label",46),o(45,"Email"),i(),e(46,"input",60),f("ngModelChange",function(t){c(n);let l=s();return g(l.currentTeacher.email,t)||(l.currentTeacher.email=t),m(t)}),i()(),e(47,"div",58)(48,"label",46),o(49,"Matricule"),i(),e(50,"input",61),f("ngModelChange",function(t){c(n);let l=s();return g(l.currentTeacher.matricule,t)||(l.currentTeacher.matricule=t),m(t)}),i()(),e(51,"div",58)(52,"label",46),o(53,"CIN"),i(),e(54,"input",62),f("ngModelChange",function(t){c(n);let l=s();return g(l.currentTeacher.cin,t)||(l.currentTeacher.cin=t),m(t)}),i()(),e(55,"div",58)(56,"label",46),o(57,"Portable"),i(),e(58,"input",63),f("ngModelChange",function(t){c(n);let l=s();return g(l.currentTeacher.phone,t)||(l.currentTeacher.phone=t),m(t)}),i()(),e(59,"div",58)(60,"label",46),o(61,"Date de Naissance"),i(),e(62,"input",64),x("ngModelChange",function(t){c(n);let l=s();return m(l.currentTeacher.birthDate=t)}),i()(),e(63,"div",58)(64,"label",46),o(65,"D\xE9partement"),i(),e(66,"select",65),f("ngModelChange",function(t){c(n);let l=s();return g(l.currentTeacher.department,t)||(l.currentTeacher.department=t),m(t)}),v(67,Q,2,2,"option",66),e(68,"option",67),o(69,"Aucun"),i()()(),e(70,"div",58)(71,"label",46),o(72,"Grade"),i(),e(73,"select",68),f("ngModelChange",function(t){c(n);let l=s();return g(l.currentTeacher.grade,t)||(l.currentTeacher.grade=t),m(t)}),e(74,"option",69),o(75,"Ma\xEEtre de Conf\xE9rences"),i(),e(76,"option",70),o(77,"Ma\xEEtre Assistant"),i(),e(78,"option",71),o(79,"Assistant"),i(),e(80,"option",72),o(81,"PES"),i(),e(82,"option",73),o(83,"Expert"),i()()(),e(84,"div",74)(85,"label",46),o(86,"Sp\xE9cialit\xE9"),i(),e(87,"input",75),f("ngModelChange",function(t){c(n);let l=s();return g(l.currentTeacher.speciality,t)||(l.currentTeacher.speciality=t),m(t)}),i()(),e(88,"div",74)(89,"label",46),o(90,"Bio / Pr\xE9sentation"),i(),e(91,"textarea",76),f("ngModelChange",function(t){c(n);let l=s();return g(l.currentTeacher.bio,t)||(l.currentTeacher.bio=t),m(t)}),i()()(),e(92,"div",77)(93,"button",78),x("click",function(){c(n);let t=s();return m(t.closeModal())}),o(94,"Annuler"),i(),e(95,"button",79),x("click",function(){c(n);let t=s();return m(t.saveChanges())}),v(96,X,1,0,"span",80),o(97),i()()()()()()()()()}if(p&2){let n=P(37),r=s();d(5),b(r.isEditMode?"Modifier le Profil Enseignant":"Ajouter un Enseignant"),d(6),u("src",r.imagePreview||r.dataService.getImageUrl(r.currentTeacher.profileImage,r.currentTeacher.name),w),d(7),h("ngModel",r.currentTeacher.status),d(10),h("ngModel",r.currentTeacher.role),d(14),h("ngModel",r.currentTeacher.name),d(4),A("bg-light",r.isEditMode),h("ngModel",r.currentTeacher.email),u("disabled",r.isEditMode),d(4),h("ngModel",r.currentTeacher.matricule),d(4),h("ngModel",r.currentTeacher.cin),d(4),h("ngModel",r.currentTeacher.phone),d(4),u("ngModel",r.formatDate(r.currentTeacher.birthDate)),d(4),h("ngModel",r.currentTeacher.department),d(),u("ngForOf",r.departments),d(6),h("ngModel",r.currentTeacher.grade),d(14),h("ngModel",r.currentTeacher.speciality),d(4),h("ngModel",r.currentTeacher.bio),d(4),u("disabled",r.isLoading||!n.valid),d(),u("ngIf",r.isLoading),d(),C(" ",r.isLoading?"Enregistrement...":r.isEditMode?"Enregistrer les modifications":"Cr\xE9er l'enseignant"," ")}}var Y=class p{constructor(a){this.dataService=a;this.teachers=[];this.departments=[];this.showModal=!1;this.currentTeacher={};this.selectedFile=null;this.imagePreview=null;this.isLoading=!1;this.isEditMode=!1}ngOnInit(){this.loadUsers(),this.loadDepartments()}loadUsers(){this.dataService.getAdminUsers().subscribe({next:a=>this.teachers=a.filter(n=>n.role==="staff"||n.role==="chef"),error:a=>console.error("Error loading users:",a)})}openAddModal(){this.isEditMode=!1,this.currentTeacher={role:"staff",status:"active",department:"",grade:"Assistant"},this.imagePreview=null,this.selectedFile=null,this.showModal=!0}loadDepartments(){this.dataService.getPartners().subscribe(),fetch(`${this.dataService.apiUrl}/public/departments`).then(a=>a.json()).then(a=>this.departments=a).catch(a=>console.error("Error loading departments:",a))}formatDate(a){return a?new Date(a).toISOString().split("T")[0]:""}onFileSelected(a){let n=a.target.files[0];if(n){this.selectedFile=n;let r=new FileReader;r.onload=t=>this.imagePreview=t.target.result,r.readAsDataURL(n)}}editTeacher(a){this.isEditMode=!0;let n=a.department?._id||a.department;this.currentTeacher=E(T({},a),{department:n}),this.imagePreview=null,this.selectedFile=null,this.showModal=!0}closeModal(){this.showModal=!1,this.currentTeacher={},this.imagePreview=null,this.selectedFile=null}saveChanges(){!this.isEditMode&&(!this.currentTeacher.email||!this.currentTeacher.name)||this.isEditMode&&!this.currentTeacher._id||(this.isLoading=!0,this.isEditMode&&this.selectedFile?this.dataService.uploadProfileImage(this.currentTeacher._id,this.selectedFile).subscribe({next:a=>{this.currentTeacher.profileImage=a.profileImage,this.performUpdate()},error:a=>{this.isLoading=!1,alert("Erreur lors de l'upload de l'image")}}):this.isEditMode?this.performUpdate():this.performCreate())}performCreate(){this.dataService.createAdminUser(this.currentTeacher).subscribe({next:a=>{this.selectedFile?this.dataService.uploadProfileImage(a._id,this.selectedFile).subscribe({next:n=>{this.teachers.unshift(n),this.finishSave()},error:()=>{this.teachers.unshift(a),this.finishSave(),alert("Utilisateur cr\xE9\xE9, mais erreur lors de l'upload de l'image.")}}):(this.teachers.unshift(a),this.finishSave())},error:a=>{this.isLoading=!1,alert("Erreur lors de la cr\xE9ation: "+(a.error?.message||a.message))}})}finishSave(){this.isLoading=!1,this.closeModal()}performUpdate(){this.dataService.updateUser(this.currentTeacher._id,this.currentTeacher).subscribe({next:a=>{this.isLoading=!1;let n=this.teachers.findIndex(r=>r._id===a._id);n!==-1&&(this.teachers[n]=a),this.closeModal()},error:a=>{this.isLoading=!1,alert("Erreur: "+(a.error?.message||a.message))}})}deleteTeacher(a){confirm("\xCAtes-vous s\xFBr de vouloir supprimer cet enseignant ?")&&this.dataService.deleteUser(a).subscribe({next:()=>this.teachers=this.teachers.filter(n=>n._id!==a),error:n=>alert("Erreur lors de la suppression")})}static{this.\u0275fac=function(n){return new(n||p)(S(O))}}static{this.\u0275cmp=y({type:p,selectors:[["app-admin-teachers"]],decls:30,vars:4,consts:[["editForm","ngForm"],[1,"admin-teachers","p-4"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"fw-bold","mb-1"],[1,"text-muted","small","mb-0"],[1,"btn","btn-add-premium",3,"click"],[1,"fas","fa-plus","me-2"],[1,"card","border-0","shadow-sm","rounded-4","overflow-hidden"],[1,"table-responsive"],[1,"table","table-hover","align-middle","mb-0"],[1,"secondary-bg-light"],[1,"ps-4"],[1,"text-end","pe-4"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","modal-backdrop fade show",4,"ngIf"],["class","modal fade show d-block","tabindex","-1",4,"ngIf"],[1,"d-flex","align-items-center"],["width","45","height","45",1,"rounded-circle","me-3","border","shadow-sm","profile-thumb",3,"src"],[1,"fw-bold","text-dark"],[1,"small","text-muted"],[1,"badge","bg-soft-primary","text-primary","border-primary-soft","px-3","py-2"],[1,"text-secondary","small","fw-medium"],[1,"badge","rounded-pill","px-3",3,"ngClass"],["title","Modifier",1,"btn","btn-icon","btn-light","me-2","hover-primary",3,"click"],[1,"fas","fa-edit"],["title","Supprimer",1,"btn","btn-icon","btn-light","text-danger","hover-danger",3,"click"],[1,"fas","fa-trash"],["colspan","5",1,"text-center","py-5","text-muted"],[1,"fas","fa-user-tie","fa-3x","mb-3","opacity-25"],[1,"modal-backdrop","fade","show"],["tabindex","-1",1,"modal","fade","show","d-block"],[1,"modal-dialog","modal-lg","modal-dialog-centered"],[1,"modal-content","border-0","shadow-lg","rounded-4","overflow-hidden"],[1,"modal-header","bg-primary","text-white","p-4","border-0"],[1,"modal-title","fw-bold"],["type","button",1,"btn-close","btn-close-white",3,"click"],[1,"modal-body","p-0"],[1,"row","g-0"],[1,"col-md-4","bg-light","p-4","text-center","border-end"],[1,"position-relative","d-inline-block","mb-4"],["width","150","height","150",1,"rounded-circle","border","shadow-sm","profile-upload-preview",3,"src"],["for","imageUpload",1,"btn","btn-primary","btn-sm","rounded-circle","position-absolute","bottom-0","end-0","p-2","shadow"],[1,"fas","fa-camera"],["type","file","id","imageUpload","accept","image/*",1,"d-none",3,"change"],[1,"mb-3","text-start"],[1,"form-label","small","text-muted","text-uppercase","fw-bold"],["name","status",1,"form-select","border-0","shadow-sm","rounded-3",3,"ngModelChange","ngModel"],["value","active"],["value","pending"],["value","inactive"],[1,"text-start"],["name","role",1,"form-select","border-0","shadow-sm","rounded-3",3,"ngModelChange","ngModel"],["value","staff"],["value","chef"],["value","admin"],[1,"col-md-8","p-4"],[1,"row","g-3"],[1,"col-md-6"],["type","text","name","name","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","email","name","email","required","",1,"form-control",3,"ngModelChange","ngModel","disabled"],["type","text","name","matricule",1,"form-control",3,"ngModelChange","ngModel"],["type","text","name","cin",1,"form-control",3,"ngModelChange","ngModel"],["type","text","name","phone",1,"form-control",3,"ngModelChange","ngModel"],["type","date","name","birthDate",1,"form-control",3,"ngModelChange","ngModel"],["name","department",1,"form-select",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["value",""],["name","grade",1,"form-select",3,"ngModelChange","ngModel"],["value","Ma\xEEtre de Conf\xE9rences"],["value","Ma\xEEtre Assistant"],["value","Assistant"],["value","PES"],["value","Expert"],[1,"col-12"],["type","text","name","speciality",1,"form-control",3,"ngModelChange","ngModel"],["name","bio","rows","3",1,"form-control",3,"ngModelChange","ngModel"],[1,"d-flex","justify-content-end","gap-2","mt-4","pt-3","border-top"],["type","button",1,"btn","btn-light","px-4",3,"click"],["type","button",1,"btn","btn-primary","px-4","fw-bold","shadow-sm",3,"click","disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],[3,"value"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(n,r){n&1&&(e(0,"div",1)(1,"div",2)(2,"div")(3,"h2",3),o(4,"Gestion des Enseignants"),i(),e(5,"p",4),o(6,"Modifiez ou g\xE9rez le personnel enseignant de l'institut."),i()(),e(7,"button",5),x("click",function(){return r.openAddModal()}),_(8,"i",6),o(9," AJOUTER UN ENSEIGNANT "),i()(),e(10,"div",7)(11,"div",8)(12,"table",9)(13,"thead",10)(14,"tr")(15,"th",11),o(16,"Enseignant"),i(),e(17,"th"),o(18,"D\xE9partement"),i(),e(19,"th"),o(20,"Grade"),i(),e(21,"th"),o(22,"Status"),i(),e(23,"th",12),o(24,"Actions"),i()()(),e(25,"tbody"),v(26,J,23,7,"tr",13)(27,H,5,0,"tr",14),i()()()()(),v(28,K,1,0,"div",15)(29,Z,98,21,"div",16)),n&2&&(d(26),u("ngForOf",r.teachers),d(),u("ngIf",r.teachers.length===0),d(),u("ngIf",r.showModal),d(),u("ngIf",r.showModal))},dependencies:[W,V,I,k,q,B,z,G,F,j,L,D,R,U,N],styles:[".rounded-4[_ngcontent-%COMP%]{border-radius:1rem!important}.bg-soft-primary[_ngcontent-%COMP%]{background-color:#3b82f614}.bg-success-soft[_ngcontent-%COMP%]{background-color:#10b9811a}.bg-warning-soft[_ngcontent-%COMP%]{background-color:#f59e0b1a}.border-primary-soft[_ngcontent-%COMP%]{border:1px solid rgba(59,130,246,.2)}.profile-thumb[_ngcontent-%COMP%]{object-fit:cover}.profile-upload-preview[_ngcontent-%COMP%]{object-fit:cover;background:#fff}.btn-icon[_ngcontent-%COMP%]{width:36px;height:36px;padding:0;display:inline-flex;align-items:center;justify-content:center;border-radius:50%;transition:all .2s}.hover-primary[_ngcontent-%COMP%]:hover{background-color:#3b82f6!important;color:#fff!important}.hover-danger[_ngcontent-%COMP%]:hover{background-color:#ef4444!important;color:#fff!important}.modal-backdrop[_ngcontent-%COMP%]{background:#00081499;backdrop-filter:blur(4px)}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border-color:#e2e8f0;border-radius:.5rem;padding:.6rem .75rem;font-size:.9rem}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}.btn-add-premium[_ngcontent-%COMP%]{background:linear-gradient(135deg,#002d72,#001b44);color:#fff;border:none;padding:.8rem 2rem;border-radius:50px;font-weight:700;letter-spacing:1px;text-transform:uppercase;font-size:.85rem;display:flex;align-items:center;box-shadow:0 4px 15px #002d724d;transition:all .3s cubic-bezier(.175,.885,.32,1.275)}.btn-add-premium[_ngcontent-%COMP%]:hover{transform:translateY(-3px) scale(1.02);box-shadow:0 8px 25px #002d7266;color:#fff}.btn-add-premium[_ngcontent-%COMP%]:active{transform:translateY(0)}"]})}};export{Y as AdminTeachersComponent};
